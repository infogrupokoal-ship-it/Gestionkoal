{% extends "base.html" %}

{% block title %}{{ 'Editar Préstamo/Alquiler' if loan else 'Añadir Préstamo/Alquiler' }}{% endblock %}

{% block content %}
    <h1>{{ 'Editar Préstamo/Alquiler' if loan else 'Añadir Préstamo/Alquiler' }}</h1>
    <div class="form-wrapper">
        <form method="post" class="form-card">
            <div class="form-group">
                <label for="activo_id">Activo</label>
                <select id="activo_id" name="activo_id" required class="form-control">
                    <option value="">-- Selecciona Activo --</option>
                    {% for asset in assets %}
                    <option value="{{ asset.id }}" {% if loan and asset.id == loan.activo_id %}selected{% endif %}>{{ asset.nombre }} ({{ asset.tipo|capitalize }})</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="usuario_id">Usuario</label>
                <select id="usuario_id" name="usuario_id" required class="form-control">
                    <option value="">-- Selecciona Usuario --</option>
                    {% for user in users %}
                    <option value="{{ user.id }}" {% if loan and user.id == loan.usuario_id %}selected{% endif %}>{{ user.username }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="fecha_inicio">Fecha de Inicio</label>
                <input type="date" id="fecha_inicio" name="fecha_inicio" value="{{ loan.fecha_inicio if loan else '' }}" required class="form-control">
            </div>

            <div class="form-group">
                <label for="fecha_fin_prevista">Fecha Fin Prevista</label>
                <input type="date" id="fecha_fin_prevista" name="fecha_fin_prevista" value="{{ loan.fecha_fin_prevista if loan else '' }}" required class="form-control">
            </div>

            <div class="form-group">
                <label for="costo_alquiler">Costo de Alquiler (€)</label>
                <input type="number" step="0.01" id="costo_alquiler" name="costo_alquiler" value="{{ loan.costo_alquiler if loan else '0.0' }}" class="form-control">
            </div>

            <div class="form-group">
                <label for="estado">Estado</label>
                <select id="estado" name="estado" required class="form-control">
                    <option value="">-- Selecciona Estado --</option>
                    {% set estados = ['activo', 'finalizado', 'vencido'] %}
                    {% for est in estados %}
                    <option value="{{ est }}" {% if loan and est == loan.estado %}selected{% endif %}>{{ est|capitalize }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="notas">Notas</label>
                <textarea id="notas" name="notas" rows="3" class="form-control">{{ loan.notas if loan else '' }}</textarea>
            </div>

            <button type="submit" class="btn btn-primary">Guardar Préstamo/Alquiler</button>
        </form>
    </div>
{% endblock %}