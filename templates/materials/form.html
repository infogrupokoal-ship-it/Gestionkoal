{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
    <h1>{{ title }}</h1>
    <div class="formulario">
        <form method="post" novalidate>
            {{ form.hidden_tag() }} {# CSRF token #}

            <div class="form-group">
                {{ form.sku.label }}
                {{ form.sku(class="form-control") }}
                {% for error in form.sku.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.nombre.label }}
                {{ form.nombre(class="form-control") }}
                {% for error in form.nombre.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.categoria.label }}
                {{ form.categoria(class="form-control") }}
                {% for error in form.categoria.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.costo_unitario.label }}
                {{ form.costo_unitario(class="form-control") }}
                {% for error in form.costo_unitario.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            {# Display Market Study Data #}
            {% if market_study_data %}
            <div class="market-study-info">
                <h4>Estudio de Mercado (<span class="status status-{{ market_study_data['difficulty'] | lower }}">{{ market_study_data['difficulty'] | capitalize }}</span>)</h4>
                <p>Precio Sugerido: Min {{ "%.2f"|format(market_study_data['price_min']) if market_study_data['price_min'] is not none else 'N/A' }} € - Avg {{ "%.2f"|format(market_study_data['price_avg']) if market_study_data['price_avg'] is not none else 'N/A' }} € - Max {{ "%.2f"|format(market_study_data['price_max']) if market_study_data['price_max'] is not none else 'N/A' }} €</p>
                <p>Fuentes: {{ market_study_data['sources_json'] | default('N/A') }}</p>
            </div>
            {% endif %}

            <div class="form-group">
                {{ form.stock_min.label }}
                {{ form.stock_min(class="form-control") }}
                {% for error in form.stock_min.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.unidad.label }}
                {{ form.unidad(class="form-control") }}
                {% for error in form.unidad.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.stock.label }}
                {{ form.stock(class="form-control") }}
                {% for error in form.stock.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.ubicacion.label }}
                {{ form.ubicacion(class="form-control") }}
                {% for error in form.ubicacion.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.proveedor_principal_id.label }}
                {{ form.proveedor_principal_id(class="form-control") }}
                {% for error in form.proveedor_principal_id.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.comision_empresa.label }}
                {{ form.comision_empresa(class="form-control") }}
                {% for error in form.comision_empresa.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>

            {{ form.submit(class="btn btn-primary") }}
            <button type="button" id="fill-example-btn" class="btn btn-secondary">Rellenar Ejemplo</button>
        </form>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('fill-example-btn').addEventListener('click', function() {
        document.getElementById('sku').value = 'MAT-9999';
        document.getElementById('nombre').value = 'ejem. Martillo de Bola';
        document.getElementById('categoria').value = 'Herramientas Manuales';
        document.getElementById('costo_unitario').value = '12.50';
        document.getElementById('stock_min').value = '5';
        document.getElementById('unidad').value = 'ud';
        document.getElementById('stock').value = '20';
        document.getElementById('ubicacion').value = 'Almacén 1, Estantería A';
        document.getElementById('comision_empresa').value = '15.0';
    });
</script>
{% endblock %}
