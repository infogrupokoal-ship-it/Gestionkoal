{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
    <h1>{{ title }}</h1>
    <div class="formulario">
        <form method="post">
            <label for="sku">SKU (Código de Artículo)</label>
            <input type="text" id="sku" name="sku" value="{{ material.sku if material else '' }}">

            <label for="nombre">Nombre del Material</label>
            <input type="text" id="nombre" name="nombre" value="{{ material.nombre if material else '' }}" required>

            <label for="categoria">Categoría</label>
            <input type="text" id="categoria" name="categoria" value="{{ material.categoria if material else '' }}">

            <label for="costo_unitario">Costo Unitario (€)</label>
            <input type="number" step="0.01" id="costo_unitario" name="costo_unitario" value="{{ material.costo_unitario if material else '' }}">

            {# Display Market Study Data #}
            {% if market_study_data %}
            <div class="market-study-info">
                <h4>Estudio de Mercado (<span class="status status-{{ market_study_data['difficulty'] | lower }}">{{ market_study_data['difficulty'] | capitalize }}</span>)</h4>
                <p>Precio Sugerido: Min {{ "%.2f"|format(market_study_data['price_min']) if market_study_data['price_min'] is not none else 'N/A' }} € - Avg {{ "%.2f"|format(market_study_data['price_avg']) if market_study_data['price_avg'] is not none else 'N/A' }} € - Max {{ "%.2f"|format(market_study_data['price_max']) if market_study_data['price_max'] is not none else 'N/A' }} €</p>
                <p>Fuentes: {{ market_study_data['sources_json'] | default('N/A') }}</p>
            </div>
            {% endif %}

            <label for="stock_min">Nivel Mínimo de Stock</label>
            <input type="number" step="1" id="stock_min" name="stock_min" value="{{ material.stock_min if material else '' }}">

            <label for="unidad">Unidad de Medida</label>
            <input type="text" id="unidad" name="unidad" value="{{ material.unidad if material else '' }}">

            <label for="stock">Stock Actual</label>
            <input type="number" step="1" id="stock" name="stock" value="{{ material.stock if material else '' }}">

            <label for="ubicacion">Ubicación</label>
            <input type="text" id="ubicacion" name="ubicacion" value="{{ material.ubicacion if material else '' }}">

            <label for="proveedor_principal_id">Proveedor Principal</label>
            <select id="proveedor_principal_id" name="proveedor_principal_id">
                <option value="">-- Selecciona Proveedor --</option>
                {% for provider in providers %}
                <option value="{{ provider.id }}" {% if material and provider.id == material.proveedor_principal_id %}selected{% endif %}>{{ provider.nombre }}</option>
                {% endfor %}
            </select>

            <label for="comision_empresa">Comisión Empresa (%)</label>
            <input type="number" step="0.01" id="comision_empresa" name="comision_empresa" value="{{ material.comision_empresa if material else '0.0' }}">

            <label for="precio_venta_sugerido">Precio Venta Sugerido (€)</label>
            <input type="number" step="0.01" id="precio_venta_sugerido" name="precio_venta_sugerido" value="{{ material.precio_venta_sugerido if material else '' }}" readonly>

            <button type="submit">Guardar</button>
            <button type="button" id="fill-example-btn">Rellenar Ejemplo</button>
        </form>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('fill-example-btn').addEventListener('click', function() {
        document.getElementById('sku').value = 'MAT-9999';
        document.getElementById('nombre').value = 'ejem. Martillo de Bola';
        document.getElementById('categoria').value = 'Herramientas Manuales';
        document.getElementById('costo_unitario').value = '12.50';
        document.getElementById('stock_min').value = '5';
        document.getElementById('unidad').value = 'ud';
        document.getElementById('stock').value = '20';
        document.getElementById('ubicacion').value = 'Almacén 1, Estantería A';
        document.getElementById('comision_empresa').value = '15.0';
    });
</script>
{% endblock %}