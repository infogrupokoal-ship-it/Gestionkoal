{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
    <h1>{{ title }}</h1>
    <div class="formulario">
        <form method="post">
            <label for="username">Usuario</label>
            <input type="text" id="username" name="username" value="{{ user.username or '' }}" required>

            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="{{ user.email or '' }}">

            <label for="password">Contraseña {% if user.id %}(dejar en blanco para no cambiar){% endif %}</label>
            <input type="password" id="password" name="password" {% if not user.id %}required{% endif %}>

            <label for="role">Rol</label>
            <select id="role" name="role" required>
                <option value="">-- Seleccionar Rol --</option>
                {% for role in roles %}
                    <option value="{{ role.code }}" {% if role.code == user_current_role_code %}selected{% endif %}>
                        {{ role.descripcion or role.code }}
                    </option>
                {% endfor %}
            </select>

            <label for="whatsapp_number">Número de WhatsApp</label>
            <input type="text" id="whatsapp_number" name="whatsapp_number" value="{{ user.whatsapp_number or '' }}">

            <div class="form-group-checkbox">
                <input type="checkbox" id="whatsapp_opt_in" name="whatsapp_opt_in" {% if user.whatsapp_opt_in %}checked{% endif %}>
                <label for="whatsapp_opt_in">Optar por notificaciones de WhatsApp</label>
            </div>

            <label for="costo_por_hora">Costo por Hora (€)</label>
            <input type="number" step="0.01" id="costo_por_hora" name="costo_por_hora" value="{{ user.costo_por_hora if user else '0.0' }}">

            <label for="tasa_recargo">Tasa de Recargo (%)</label>
            <input type="number" step="0.01" id="tasa_recargo" name="tasa_recargo" value="{{ user.tasa_recargo if user else '0.0' }}">

            <button type="submit">Guardar</button>
            <button type="button" id="fill-example-btn">Rellenar Ejemplo</button>
        </form>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('fill-example-btn').addEventListener('click', function() {
        document.getElementById('username').value = 'ejem.tecnico';
        document.getElementById('email').value = 'tecnico@ejemplo.com';
        document.getElementById('password').value = 'password123';
        
        // Set the role dropdown to a default value, e.g., 'tecnico'
        const roleSelect = document.getElementById('role');
        if (roleSelect) {
            const tecnicoOption = roleSelect.querySelector('option[value="tecnico"]');
            if (tecnicoOption) {
                roleSelect.value = 'tecnico';
            } else if (roleSelect.options.length > 1) {
                // As a fallback, select the second option (the first real role)
                roleSelect.selectedIndex = 1;
            }
        }
        document.getElementById('costo_por_hora').value = '25.00';
        document.getElementById('tasa_recargo').value = '10.00';
    });
</script>
{% endblock %}