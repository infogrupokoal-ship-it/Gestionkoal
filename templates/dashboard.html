{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <h1>Dashboard</h1>

    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-number">{{ total_tickets }}</div>
            <div>Total Trabajos</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ pending_tickets }}</div>
            <div>Trabajos Pendientes</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ pending_payments }}</div>
            <div>Pagos Pendientes</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ total_clients }}</div>
            <div>Total Clientes</div>
        </div>
    </div>

    <div class="tickets-table">
        <h2>Trabajos Recientes</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Título</th>
                    <th>Cliente</th>
                    <th>Asignado a</th>
                    <th>Estado</th>
                    <th>Fecha Creación</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                <tr>
                    <td>{{ ticket.id }}</td>
                    <td>{{ ticket.descripcion }}</td>
                    <td>{{ ticket.client_nombre or 'N/A' }}</td>
                    <td>{{ ticket.assigned_user_username or 'N/A' }}</td>
                    <td>{{ ticket.estado }}</td>
                    <td>{{ ticket.created_at }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6">No hay trabajos recientes.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id='calendar'></div>

{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,listWeek'
      },
      events: '/api/trabajos',
      locale: 'es',
      eventClick: function(info) {
        window.location.href = '/trabajos/edit/' + info.event.id;
      }
    });
    calendar.render();
  });
</script>
{% endblock %}
