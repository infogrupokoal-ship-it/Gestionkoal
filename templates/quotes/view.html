{% extends "base.html" %}

{% block title %}Ver/Editar Presupuesto #{{ presupuesto.id }}{% endblock %}

{% block content %}
    <h1>Presupuesto #{{ presupuesto.id }}</h1>
    <div class="formulario">
        <form method="post">
            <label for="estado">Estado del Presupuesto</label>
            <select id="estado" name="estado">
                {% set estados = ['pendiente', 'aceptado', 'rechazado'] %}
                {% for estado_option in estados %}
                <option value="{{ estado_option }}" {% if estado_option == presupuesto.estado %}selected{% endif %}>{{ estado_option|capitalize }}</option>
                {% endfor %}
            </select>

            <h2>Items del Presupuesto</h2>
            <div id="items-container">
                {% for i in range(items|length) %}
                {% set item = items[i] %}
                <div class="item-row">
                    <input type="hidden" name="item_id_{{ i }}" value="{{ item.id }}">
                    <label for="item_descripcion_{{ i }}">Descripción</label>
                    <input type="text" id="item_descripcion_{{ i }}" name="item_descripcion_{{ i }}" value="{{ item.descripcion or '' }}" placeholder="Descripción del ítem">

                    <label for="item_qty_{{ i }}">Cantidad</label>
                    <input type="number" step="0.01" id="item_qty_{{ i }}" name="item_qty_{{ i }}" value="{{ item.qty or '' }}">

                    <label for="item_precio_unit_{{ i }}">Precio Unitario (€)</label>
                    <input type="number" step="0.01" id="item_precio_unit_{{ i }}" name="item_precio_unit_{{ i }}" value="{{ item.precio_unit or '' }}">
                </div>
                {% endfor %}

                {# Add empty rows for new items if needed, or just allow 3 fixed for now #}
                {% for i in range(items|length, 3) %}
                <div class="item-row">
                    <input type="hidden" name="item_id_{{ i }}" value="">
                    <label for="item_descripcion_{{ i }}">Descripción</label>
                    <input type="text" id="item_descripcion_{{ i }}" name="item_descripcion_{{ i }}" placeholder="Descripción del ítem">

                    <label for="item_qty_{{ i }}">Cantidad</label>
                    <input type="number" step="0.01" id="item_qty_{{ i }}" name="item_qty_{{ i }}" value="1">

                    <label for="item_precio_unit_{{ i }}">Precio Unitario (€)</label>
                    <input type="number" step="0.01" id="item_precio_unit_{{ i }}" name="item_precio_unit_{{ i }}" value="0.00">
                </div>
                {% endfor %}
            </div>

            <button type="submit">Actualizar Presupuesto</button>
        </form>
        <form action="{{ url_for('quotes.delete_quote', quote_id=presupuesto.id) }}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-danger" onclick="return confirm('¿Estás seguro de que quieres eliminar este presupuesto y todos sus ítems?');">Eliminar Presupuesto</button>
        </form>
    </div>
{% endblock %}
