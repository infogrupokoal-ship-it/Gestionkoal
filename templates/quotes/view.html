{% extends "base.html" %}

{% block title %}Ver Presupuesto{% endblock %}

{% block content %}
    <h1>Presupuesto #{{ quote.id }}</h1>
    <div class="quote-details">
        <p><strong>Trabajo Asociado:</strong> <a href="{{ url_for('edit_trabajo', trabajo_id=trabajo.id) }}">{{ trabajo.titulo }}</a></p>
        <p><strong>Autónomo:</strong> {{ autonomo.username }}</p>
        <p><strong>Fecha del Presupuesto:</strong> {{ quote.quote_date }}</p>
        <p><strong>Monto Total:</strong> €{{ "{:,.2f}".format(quote.total_quote_amount) }}</p>
        <p><strong>Estado:</strong> {{ quote.status }}</p>
        <p><strong>Notas para el Cliente:</strong> {{ quote.client_notes or 'N/A' }}</p>
        <p><strong>Notas Internas:</strong> {{ quote.freelancer_notes or 'N/A' }}</p>
    </div>

    {% if quote_files %}
    <div class="uploaded-files-section">
        <h2>Archivos Adjuntos</h2>
        <ul>
            {% for file in quote_files %}
            <li><a href="{{ url_for('uploaded_file', filename=file.file_name) }}" target="_blank">{{ file.file_name }}</a></li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="actions">
        <a href="{{ url_for('edit_quote', quote_id=quote.id) }}" class="btn btn-secondary">Editar Presupuesto</a>
        <form action="{{ url_for('delete_quote', quote_id=quote.id) }}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-danger" onclick="return confirm('¿Estás seguro de que quieres eliminar este presupuesto?');">Eliminar Presupuesto</button>
        </form>
        {% if quote.status == 'Pendiente' %}
        <form action="{{ url_for('accept_quote', quote_id=quote.id) }}" method="post" style="display:inline; margin-left: 10px;">
            <button type="submit" class="btn btn-success" onclick="return confirm('¿Estás seguro de que quieres ACEPTAR este presupuesto?');">Aceptar Presupuesto</button>
        </form>
        <form action="{{ url_for('reject_quote', quote_id=quote.id) }}" method="post" style="display:inline; margin-left: 10px;">
            <button type="submit" class="btn btn-warning" onclick="return confirm('¿Estás seguro de que quieres RECHAZAR este presupuesto?');">Rechazar Presupuesto</button>
        </form>
        {% endif %}
    </div>

    <style>
        .quote-details p {
            margin-bottom: 5px;
        }
        .quote-details strong {
            display: inline-block;
            width: 150px;
        }
        .uploaded-files-section {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        .uploaded-files-section ul {
            list-style: none;
            padding: 0;
        }
        .uploaded-files-section li {
            margin-bottom: 5px;
        }
        .actions {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
    </style>
{% endblock %}